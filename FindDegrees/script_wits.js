const WitsData = {
  "University of Witwatersrand (Wits)": [
    {
      "degree": "BCom Accounting",
      "requirements": {
        "APS": 38,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 5
      },
      "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/clm/accounting/"
    },
    {
      "degree": "Accounting Science",
      "requirements": {
        "APS": 44,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 6
      },
        "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/clm/accounting-science-baccsc/"
    },
    {
      "degree": "Actuarial Science",
      "requirements": {
        "APS": 42,
        "English Home Language": 7,
        "English First Additional Language": 7,
        "Mathematics": 7,
        "Physical Science": 7
      },

    "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/science/actuarial-science/" 
    },
    {
      "degree": "Aeronautical Engineering",
      "requirements": {
        "APS": 42,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 5,
        "Physical Sciences": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/ebe/aeronautical-engineering/" 
    },
    {
      "degree": "Applied Bioinformatics",
      "requirements": {
        "APS": 43,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/science/applied-bioinformatics/" 
    },
    {
      "degree": "Applied Chemistry",
      "requirements": {
        "APS": 42,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 6,
        "Physical Science": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/science/applied-chemistry/" 
    },
    {
      "degree": "Architectural Studies",
      "requirements": {
        "APS": 29,
        "English Home Language": 4,
        "English First Additional Language": 4,
        "Mathematics": 4,
        "Afrikaans Eerste Additionlele Taal" : 4,   
        

      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/ebe/architectural-studies/" 
    },
    {
      "degree": "Astronomy and Astrophysics",
      "requirements": {
        "APS": 43,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 6,
        "Physical Science": 6
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/science/astronomy-and-astrophysics/" 
    },
    {
      "degree": "Audiology",
      "requirements": {
        "APS": 34,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 4
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/humanities/audiology/" 
    },
    {
      "degree": "Bachelor of Arts (General BA)",
      "requirements": {
        "APS": 36,
        "English Home Language": 5,
        "English First Additional Language": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/humanities/ba/" 
    },
    {
      "degree": "Bachelor of Commerce (General)",
      "requirements": {
        "APS": 38,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/clm/bcom/" 
    },
    {
      "degree": "Bachelor of Engineering Science in Digital Arts",
      "requirements": {
        "APS": 42,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 5,
        "Physical Sciences": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/ebe/digital-arts/" 
    },
    {
      "degree": "Bachelor of Laws (LLB) - Four-year stream (LFA14)",
      "requirements": {
        "APS": 46,
        "English Home Language": 6,
        "English First Additional Language": 6,
        "Mathematics": 4,
        "Maths Literacy": 6
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/clm/llb-law/" 
    },
    {
      "degree": "Bachelor of Music",
      "requirements": {
        "APS": 34,
        "English Home Language": 5,
        "English First Additional Language": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/humanities/music/" 
    },
    {
      "degree": "Bachelor of Science (BSc) - BSc General",
      "requirements": {
        "APS": 42,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/science/bsc/" 
    },
    {
      "degree": "Bachelor of Science in Construction Studies",
      "requirements": {
        "APS": 36,
        "English Home Language": 4,
        "English First Additional Language": 4,
        "Mathematics": 4
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/ebe/construction-studies/" 
    },
    {
      "degree": "Bachelor of Science in Urban and Regional Planning",
      "requirements": {
        "APS": 36,
        "English Home Language": 4,
        "English First Additional Language": 4,
        "Mathematics": 4
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/ebe/urban-and-regional-planning/" 
    },
    {
      "degree": "Biochemistry and Cell Biology",
      "requirements": {
        "APS": 43,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/science/biochemistry-and-cell-biology/" 
    },
    {
      "degree": "Biodiversity",
      "requirements": {
        "APS": 43,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/health/biokinetics/" 
    },
    {
      "degree": "Biokinetics",
      "requirements": {
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 5,
        "Life Sciences": 5,
        "Physical Sciences": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/science/actuarial-science/" 
    },
    {
      "degree": "Biological Sciences (Organismal Biology)",
      "requirements": {
        "APS": 43,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/science/organismal-biology/" 
    },
    {
      "degree": "Biomedical Engineering",
      "requirements": {
        "APS": 42,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 5,
        "Physical Sciences": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/ebe/biomedical-engineering/" 
    },
    {
      "degree": "Biomedical Sciences",
      "requirements": {
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 5,
        "Life Sciences": 5,
        "Physical Sciences": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/health/biomedical-sciences/" 
    },
    {
      "degree": "Chemical Engineering",
      "requirements": {
        "APS": 42,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 5,
        "Physical Sciences": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/ebe/chemical-engineering/" 
    },
    {
      "degree": "Chemistry",
      "requirements": {
        "APS": 42,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 6,
        "Physical Science": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/science/chemistry/" 
    },
    {
      "degree": "Chemistry with Chemical Engineering",
      "requirements": {
        "APS": 43,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 6,
        "Physical Science": 6
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/science/chemistry-with-chemical-engineering/" 
    },
    {
      "degree": "Bachelor of Education in Intermediate Phase Teaching",
      "requirements": {
        "APS": 37,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 4,
        "Maths Literacy": 5,
        "Technical Mathematics": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/humanities/bed-intermediate-phase-teaching/" 
    },
    {
      "degree": "Bachelor of Education in Senior Phase and Further Education and Training",
      "requirements": {
        "APS": 37,
        "English Home Language": 5,
        "English First Additional Language": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/humanities/bed-senior-phase-teaching/" 
    },
    {
      "degree": "Bachelor of Education: Foundation Phase Teaching",
      "requirements": {
        "APS": 37,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 4,
        "Maths Literacy": 5,
        "Technical Mathematics": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/humanities/bed-foundation-phase-teaching/" 
    },
    {
      "degree": "Speech-Language Pathology",
      "requirements": {
        "APS": 34,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 4
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/humanities/speech-language-pathology/" 
    },
    {
      "degree": "Social Work",
      "requirements": {
        "APS": 34,
        "English Home Language": 5,
        "English First Additional Language": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/humanities/social-work/" 
    },
    {
      "degree": "Property Studies",
      "requirements": {
        "APS": 36,
        "English Home Language": 4,
        "English First Additional Language": 4,
        "Mathematics": 4
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/ebe/property-studies/" 
    },
    {
      "degree": "Politics, Philosophy and Economics (PPE)",
      "requirements": {
        "APS": 38,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/clm/ppe/" 
    },
    {
      "degree": "Physiotherapy",
      "requirements": {
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 5,
        "Life Sciences": 5,
        "Physical Sciences": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/health/physiotherapy/" 
    },
    {
      "degree": "Physics",
      "requirements": {
        "APS": 42,
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 6,
        "Physical Science": 5
      },
       "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/science/physics/" 
    },
    {
      "degree": "Pharmacy",
      "requirements": {
        "English Home Language": 5,
        "English First Additional Language": 5,
        "Mathematics": 5,
        "Life Sciences": 5,
        "Physical Sciences": 5
      },
      "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/health/pharmacy/",
      "Requirements": "APS 42+"
    },
    {
      "degree": "Oral Health Sciences",
      "requirements": {
        "English Home Language": 4,
        "English First Additional Language": 4,
        "Mathematics": 4,
        "Maths Literacy": 7,
        "Life Sciences": 4,
        "Physical Sciences": 4
      },
      "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/health/oral-health-sciences/"
    },
    {
      "degree": "Occupational Therapy",
      "requirements": {
        "English Home Language": 4,
        "English First Additional Language": 4,
        "Mathematics": 4,
        "Life Sciences": 4,
        "Physical Sciences": 4
      },
      "websiteURL": "https://www.wits.ac.za/course-finder/undergraduate/health/occupational-therapy/"
    }
  ]
};

let subjectCounter = 0;

function addSubject() {
  if (subjectCounter >= 7) {
      alert("You can only select up to 7 subjects.");
      return;
  }
  subjectCounter++;
  
  const subjectContainer = document.createElement("div");
  subjectContainer.classList.add("subject-wrapper");

  const subjectDiv = document.createElement("div");
  subjectDiv.classList.add("subject-container");

  const select = document.createElement("select");
  select.classList.add("subject");
  select.id = "subjects" + subjectCounter;
  
  const option = document.createElement("option");
  option.value = "";
  option.textContent = "Select a subject";
  select.appendChild(option);
  
  // Define categories
  const categories = {
      "Language 1": ["English Home Language", "Afrikaans Huistaal", "Sesotho Home Language", "Siswati Home Language", "Setswana Home Language", "isiZulu Home Language", "isiXhosa Home Language", "isiNdebele Home Language", "Sepedi Home Language", "Xitsonga Home Language", "Tshivenda Home Language"],
      "Language 2": ["English First Additional Language", "Afrikaans Eerste Additionele Taal"],
      "Maths": ["Mathematics", "Mathematical Literacy", "Technical Mathematics"],
      "LO": ["Life Orientation"],
      "Subject 5": ["Computer Applications Technology","Economics", "Physical Sciences", "Life Sciences", "Agricultural Sciences", "Business Studies", "Accounting", "Information Technology","History", "Geography", "Religious Studies, History, Tourism"],
      "Subject 6": ["Computer Applications Technology","Economics", "Physical Sciences", "Life Sciences", "Agricultural Sciences", "Business Studies", "Accounting", "Information Technology","History", "Geography", "Religious Studies, History, Tourism"],
      "Subject 7": ["Computer Applications Technology","Economics", "Physical Sciences", "Life Sciences", "Agricultural Sciences", "Business Studies", "Accounting", "Information Technology","History", "Geography", "Religious Studies, History, Tourism"],
  };
  
  // Populate select options based on categories
  for (const category in categories) {
      const optgroup = document.createElement("optgroup");
      optgroup.label = category;
      categories[category].forEach(subject => {
          const option = document.createElement("option");
          option.value = subject;
          option.textContent = subject;
          optgroup.appendChild(option);
      });
      select.appendChild(optgroup);
  }

  subjectDiv.appendChild(select);

  const input = document.createElement("input");
  input.type = "number";
  input.classList.add("percentage-input");
  input.id = "percentage" + subjectCounter;
  input.min = "0";
  input.max = "100";
  input.placeholder = "%";
  input.style.width = "50px";
  input.value = "75";

  subjectDiv.appendChild(input);

  const deleteButton = document.createElement("button");
  deleteButton.classList.add("delete-button");
  deleteButton.textContent = "Delete";
  deleteButton.onclick = function() { deleteSubject(this); };
  subjectDiv.appendChild(deleteButton);

  subjectContainer.appendChild(subjectDiv);
  document.getElementById("subject-container").appendChild(subjectContainer);
}

// Function to delete a subject
function deleteSubject(button) {
  const subjectContainer = button.closest('.subject-wrapper');
  subjectContainer.remove();
  subjectCounter--;
}

// Function to display eligible degrees based on user inputs
function displayEligibleDegrees() {
    // Get the selected subjects from the form
    const selectedSubjects = [];
    const subjectContainers = document.querySelectorAll('.subject-container');

    // Loop through the subject containers to get selected subjects
    subjectContainers.forEach(subjectContainer => {
        const subjectInput = subjectContainer.querySelector('.subject');
        if (subjectInput.value !== "") {
            selectedSubjects.push(subjectInput.value);
        }
    });

    // Get the percentages and APS from the form
    const percentageInputs = document.querySelectorAll('.percentage-input');
    const percentages = Array.from(percentageInputs).map(input => parseInt(input.value));

    const apsInput = document.getElementById('aps');
    const aps = parseInt(apsInput.value);

    // Initialize an array to store eligible degrees
    let eligibleDegrees = [];

    // Iterate through each degree in the WitsData
    WitsData["University of Witwatersrand (Wits)"].forEach(degree => {
        // Flag to track if all subject requirements are met
        let allSubjectsMet = true;

        // Check if each subject requirement is met
        Object.keys(degree.requirements).forEach(subject => {
            if (subject === "APS") {
                if (aps < degree.requirements[subject]) {
                    allSubjectsMet = false;
                }
            } else if (subject === "English Home Language" || subject === "English First Additional Language") {
                // Check if either English Home Language or English First Additional Language meets the requirement
                let englishSubjectIndex = selectedSubjects.indexOf("English Home Language");
                let additionalEnglishSubjectIndex = selectedSubjects.indexOf("English First Additional Language");
                if (englishSubjectIndex === -1 && additionalEnglishSubjectIndex === -1) {
                    allSubjectsMet = false;
                }
            } else {
                let subjectIndex = selectedSubjects.indexOf(subject);
                if (subjectIndex !== -1) {
                    let subjectLevel = calculateLevel(percentages[subjectIndex]);
                    if (subjectLevel < degree.requirements[subject]) {
                        allSubjectsMet = false;
                    }
                } else {
                    allSubjectsMet = false;
                }
            }
        });

        // If all subject requirements are met, add the degree to eligibleDegrees
        if (allSubjectsMet) {
            eligibleDegrees.push(degree);
        }
    });

    // Display the eligible degrees on the screen
    let resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = "<h2>Eligible Degrees:</h2>";
    if (eligibleDegrees.length > 0) {
        let list = document.createElement('ul');
        eligibleDegrees.forEach(degree => {
            let listItem = document.createElement('li');
            let link = document.createElement('a');
            link.textContent = degree.degree;
            link.href = degree.websiteURL; // Set the href to the website URL
            link.target = "_blank"; // Open the link in a new tab
            listItem.appendChild(link);
            list.appendChild(listItem);
        });
        resultsDiv.appendChild(list);
    } else {
        resultsDiv.innerHTML += "<p>No degrees found matching your criteria.</p>";
    }
}

// Function to calculate the level based on the percentage
function calculateLevel(percentage) {
    if (percentage >= 80) return 7;
    else if (percentage >= 70) return 6;
    else if (percentage >= 60) return 5;
    else if (percentage >= 50) return 4;
    else if (percentage >= 40) return 3;
    else if (percentage >= 30) return 2;
    else return 1;
}
